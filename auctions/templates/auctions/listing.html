{% extends "auctions/layout.html" %}

{% block body %}
    <h1> {{listing.title}}</h2>
    <h3>Listed by: {{listing.creator}}</h3>
    <h6>Published on: {{listing.pub_date}}</h4>
    <p> {{listing.description}}</p>
    <br>
    
    <div>
        <h4>Minimum Bid: </h4>
            <p>R {{minimum_bid}}</p>
    </div>

    <div>
        <h4>Current bid: </h4>
            <p>R {{current_bid}}</p>
            <p4>{{count_offers}} bid(s) made so far</p4>
    </div>

    <!--Form section only shows up if the listing is still active/open and not closed-->

    {% if listing_activity == True %}
        <!-- Form section to allow logged in user to place a bid -->
        <div>
            <form action="{% url 'listings' listing.id %}" method="post">
                {% csrf_token %}
                <input type="number" id="{{user.id}}" name="creator" value="{{user.id}}" hidden>
                <input class="form-control" type="number" name="bid" placeholder="bid">

                <!--showing success message-->
                {% if messages %}
                <ul class="messages">
                    {% for message in messages %}
                        <li {% if message.tags%} class="{{ message.tags }}" {% endif %}>{{message}}</li>
                    {% endfor %}
                </ul>
                {% endif %}

                <!-- Using multiple submit buttons, one to bid, other to atdd item to watchlist. first button submits to the default URL-->
                <input class="btn btn-primary" type="submit" value="Place Bid!" id="bid" name="place">
                <!--This button will post to the "watchlist" url using the formaction attribute to add a custom URL to submit data to-->

                <!-- For this add/remove button, we need to check the watchlist status, whether the listing is the watchlist (true) or otherwise-->
                {% if status == True %}
                    <input id="remove" class="btn btn-danger" type="submit" value="remove from Wishlist" name="remove">
                {% else %}
                <input id="remove" class="btn btn-primary" type="submit" value="Add to Wishlist" name="add">
                {% endif %}

                {% if close_auction_btn == True %}
                    <div>
                        <input id="close" class="btn btn-warning" type="submit" value="close Auction" name="close">
                    </div>
                {% endif %}
                <!--<input id="wishlist" class="btn btn-primary" type="submit" value="Add to Wishlist" name="wishlist">--> 

                <!-- Add ability for users to add comments -->
                <div>
                    <h3>Comments</h3>
                        <ul>
                            {% for comment in comments %}
                                <div class="comment_username">
                                    <strong>{{comment.commented_by}}</strong>
                                </div>
                                <li>{{comment.description}}</li>
                            {% empty %}
                            <li>No comments posted for this listing</li>
                            {% endfor %}
                        </ul>
                    <!-- Text Area for comments -->
                    <p><label for="add_comments"><strong>Type in your thoughts below</strong></label></p>
                    <textarea id="add_comments" name="add_comments" rows="4" cols="100" placeholder="Add comments to this listing"></textarea>
                    <br>
                    <input type="submit" id="comment" class="btn btn-primary" value="post comment" name="comment">
                </div>
            </form>
        </div>
    {% else %}
        <div>
            <h1><em>The auction for this listing has been closed and no longer active for bidding</em></h1>
        </div>

    {% endif %}

    <!-- Display winner when the auction is closed and logged_in user won the bid -->
    {% if user.id == buyer_obj.id %}
        <div>
            <h1><em>{{buyer_obj.username}}</em>, you have won this auction YAAAYY!</h1>
        </div>
    {% endif %}
    
    
    <div>
        Category
        <ul>
            {% for cat in categories %}
                <li><a href="{% url 'filtered' cat.id %}">{{cat.name}}</a></li>
                {% empty %}
                <li>No Categories Listed</li>
            {% endfor %}
        </ul>
    </div>

    <div>
        <p3>Listed by: <strong>{{listing.creator}}</strong></p3>
        <br>
        <p4>Listing date: {{listing.pub_date}}</p4>
    </div>
{% endblock %}